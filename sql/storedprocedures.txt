USE [qm]
GO
/****** Object:  StoredProcedure [dbo].[GetAllWorkGroups]    Script Date: 5/1/2018 12:58:33 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetAllWorkGroups] 
	-- Add the parameters for the stored procedure here
	
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	Select workgroupid, workgroupname from workgroup where status = 1
END

GO
/****** Object:  StoredProcedure [dbo].[GetReport]    Script Date: 5/1/2018 12:58:33 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[GetReport] 
	@startdate datetime,
	@endDate datetime,
	@workgroupid varchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	--select wi.workgroupid,m.starttime, m.endtime,m.mediaid, m.dnis,m.ani, r.updateuserid,
	--r.percentscore,r.overallscore,
	--r.reviewdate, i.username, i.userroleid, i.usertypeid,
	--w.workgroupname, s.description, s.name, s.sequencenumber, s.weight, 
	--q.questiondescription, q.questionnumber, q.questiontext, q.weight, q.responserequired,
	--q.questionadditionalpoint,q.autofailpoint,q.questionadditionalconditionpoint
	--from media m inner join review r on m.mediaid = r.mediaid
	--inner join iqmuser i on i.userid = r.owneruserid
	--inner join workgroup_iqmuser wi on wi.userid = r.owneruserid
	--inner join workgroup w on w.workgroupid = wi.workgroupid
	--inner join sectionresult sr on sr.reviewid = r.reviewid
	--inner join section s on s.sectionid = sr.sectionid
	--inner join question q on q.sectionid = s.sectionid
	--where wi.workgroupid = @workgroupid and m.starttime >= @startdate and m.endtime <= @endDate
	select w.workgroupid,m.starttime, m.endtime,m.mediaid, m.dnis,m.ani, r.updateuserid,
	r.percentscore,r.overallscore,
	r.reviewdate, i.username, i.userroleid, i.usertypeid,
	w.workgroupname, s.description, s.name, s.sequencenumber, s.weight, 
	q.questiondescription, q.questionnumber, q.questiontext, q.weight, q.responserequired,
	q.questionadditionalpoint,q.autofailpoint,q.questionadditionalconditionpoint
	from media m inner join review r on m.mediaid = r.mediaid
	inner join iqmuser i on i.userid = r.owneruserid
	inner join workgroup_iqmuser wi on wi.userid = r.owneruserid
	inner join workgroup w on w.workgroupid = wi.workgroupid
	inner join sectionresult sr on sr.reviewid = r.reviewid
	inner join section s on s.sectionid = sr.sectionid
	inner join question q on q.sectionid = s.sectionid
	where w.workgroupid = @workgroupid and m.starttime >= @startdate and m.endtime <= @endDate

END


GO
/****** Object:  StoredProcedure [dbo].[GetReportcsvList]    Script Date: 5/1/2018 12:58:33 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[GetReportcsvList] 
	-- Add the parameters for the stored procedure here
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	Select * from ReportsGenerated order by ID desc
END
GO
/****** Object:  StoredProcedure [dbo].[InsertReport]    Script Date: 5/1/2018 12:58:33 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

-- ============================================= 

-- Author:        <Author,,Name> 

-- Create date: <Create Date,,> 

-- Description:    <Description,,> 

-- ============================================= 

CREATE PROCEDURE [dbo].[InsertReport]  

    @ReportGeneratedFileName varchar(MAX),
	@CreatedOn datetime,
	@CreatedBy varchar(MAX),
	@MethodofCreation varchar(MAX),
	@ReportGeneratedFullPath varchar(MAX),
	@ReportLocation varchar(MAX)

AS 
BEGIN 
    SET NOCOUNT ON; 

      INSERT INTO [dbo].[ReportsGenerated] (
	  ReportGeneratedFileName, CreatedOn, CreatedBy,MethodofCreation,ReportGeneratedFullPath,ReportLocation
	  ) 

VALUES (

 @ReportGeneratedFileName,
	@CreatedOn,
	@CreatedBy,
	@MethodofCreation,
	@ReportGeneratedFullPath,
	@ReportLocation
); 


END 


GO





USE [qm]
GO

/****** Object:  Table [dbo].[ReportsGenerated]    Script Date: 5/1/2018 1:31:39 AM ******/
DROP TABLE [dbo].[ReportsGenerated]
GO

/****** Object:  Table [dbo].[ReportsGenerated]    Script Date: 5/1/2018 1:31:39 AM ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

CREATE TABLE [dbo].[ReportsGenerated](
	[ID] [int] IDENTITY(1,1) NOT NULL,
	[ReportGeneratedFileName] [varchar](max) NULL,
	[CreatedOn] [datetime] NULL,
	[CreatedBy] [varchar](max) NULL,
	[MethodofCreation] [varchar](max) NULL,
	[ReportGeneratedFullPath] [varchar](max) NULL,
	[ReportLocation] [varchar](max) NULL
) ON [PRIMARY] TEXTIMAGE_ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO



